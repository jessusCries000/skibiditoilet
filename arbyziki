local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Remote for server validation
local AimAssistRequest = ReplicatedStorage:WaitForChild("AimAssistRequest")

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "barsyc_cc"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 100)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.new(1,1,1)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "barsyc.cc AimAssist"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.BackgroundTransparency = 1
title.TextColor3 = Color3.new(0,0,0)
title.Parent = mainFrame

-- FOV Controls
local fov = 150

local fovLabel = Instance.new("TextLabel")
fovLabel.Size = UDim2.new(1, 0, 0, 30)
fovLabel.Position = UDim2.new(0,0,0,35)
fovLabel.Text = "FOV: "..fov
fovLabel.BackgroundTransparency = 1
fovLabel.TextColor3 = Color3.new(0,0,0)
fovLabel.Font = Enum.Font.SourceSans
fovLabel.TextSize = 18
fovLabel.Parent = mainFrame

local incBtn = Instance.new("TextButton")
incBtn.Size = UDim2.new(0.5, -5, 0, 30)
incBtn.Position = UDim2.new(0,0,0,70)
incBtn.Text = "+"
incBtn.Parent = mainFrame

local decBtn = Instance.new("TextButton")
decBtn.Size = UDim2.new(0.5, -5, 0, 30)
decBtn.Position = UDim2.new(0.5,5,0,70)
decBtn.Text = "-"
decBtn.Parent = mainFrame

incBtn.MouseButton1Click:Connect(function()
    fov += 10
    fovLabel.Text = "FOV: "..fov
end)

decBtn.MouseButton1Click:Connect(function()
    fov = math.max(50, fov - 10)
    fovLabel.Text = "FOV: "..fov
end)

-- Draw FOV Circle
local circle = Drawing.new("Circle")
circle.Color = Color3.new(1,1,1)
circle.Thickness = 1.5
circle.NumSides = 64
circle.Filled = false
circle.Radius = fov

-- Find best target in FOV
local function getClosestTarget()
    local closest, distance = nil, math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local screenPos = Vector2.new(pos.X,pos.Y)
                    local mousePos = UserInputService:GetMouseLocation()
                    local dist = (screenPos - mousePos).Magnitude
                    if dist < fov and dist < distance then
                        closest = head
                        distance = dist
                    end
                end
            end
        end
    end
    return closest
end

-- Render loop
RunService.RenderStepped:Connect(function()
    local mousePos = UserInputService:GetMouseLocation()
    circle.Position = mousePos
    circle.Radius = fov

    local target = getClosestTarget()
    if target then
        -- Ask server to validate aim
        AimAssistRequest:FireServer(target)
    end
end)
